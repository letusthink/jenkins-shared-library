#!groovy

//使用共享库
@Library('jenkins-shared-library@main') _

//调用函数
def tools = new org.color()
def checkout = new org.checkout()

pipeline {
    agent {
        kubernetes {
            retries 2
            yaml '''               
            apiVersion: v1
            kind: Pod
            spec:
              containers:
              - name: git
                image: registry.cn-hangzhou.aliyuncs.com/tool-bucket/tool:git
                command:
                - cat
                tty: true              
              - name: golang
                image: golang:1.16.5
                command:
                - cat
                tty: true                                
            '''
        }
    }
    options {
        skipDefaultCheckout true
    }

    stages{
    stage("GetCode"){
        steps{
            script{
                checkout scmGit(branches: [[name: "${env.branchName}"]], 
                    extensions: [], userRemoteConfigs: [[credentialsId: 'GitHub_SSH_Credentials', 
                    url: "${env.srcUrl}"]])
                sh "ls -l"
                }
            }        
        }
    }
}